<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test VOP AI - Assistant IA 24/7</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #003399, #00B0F0);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #FFD700;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #FFD700;
        }
        .test-button {
            background: #00B0F0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        .test-button:hover {
            background: #003399;
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
        .info {
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Test VOP AI - Assistant IA 24/7</h1>
        
        <div class="test-section">
            <h3>üìä Test de Connexion √† la Base de Donn√©es</h3>
            <button class="test-button" onclick="testDatabaseConnection()">Tester la Connexion</button>
            <div id="dbResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üß† Test des Connaissances VOP AI</h3>
            <button class="test-button" onclick="testKnowledgeBase()">Tester la Base de Connaissances</button>
            <div id="knowledgeResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üí¨ Test des Conversations IA</h3>
            <button class="test-button" onclick="testConversations()">Tester les Conversations</button>
            <div id="conversationResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üìà Test des Statistiques IA</h3>
            <button class="test-button" onclick="testAIStats()">Tester les Statistiques</button>
            <div id="statsResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîê Test des Politiques RLS</h3>
            <button class="test-button" onclick="testRLSPolicies()">Tester les Politiques</button>
            <div id="rlsResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Test Complet VOP AI</h3>
            <button class="test-button" onclick="runFullTest()">Lancer le Test Complet</button>
            <div id="fullTestResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Configuration Supabase - Cl√©s VOP
        const SUPABASE_URL = 'https://zfekgfupuzpnuixaqrsd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmZWtnZnVwdXpwbnVpeGFxcnNkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMjQ1NDksImV4cCI6MjA3MzkwMDU0OX0.UF06Fiz4pw5N8MEnOlzrZynzyuwQTMMNLckwDBkgr3k';

        // Fonction pour afficher les r√©sultats
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }

        // Test de connexion √† la base de donn√©es
        async function testDatabaseConnection() {
            showResult('dbResult', 'üîÑ Test de connexion en cours...', 'info');
            
            try {
                // Simulation d'un test de connexion
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_knowledge?select=count`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    showResult('dbResult', '‚úÖ Connexion √† la base de donn√©es r√©ussie!\n\nTables VOP AI disponibles:\n- ai_conversations\n- ai_knowledge\n- ai_sessions\n- ai_feedback', 'success');
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                showResult('dbResult', `‚ùå Erreur de connexion:\n${error.message}\n\nV√©rifiez vos cl√©s Supabase dans le script.`, 'error');
            }
        }

        // Test de la base de connaissances
        async function testKnowledgeBase() {
            showResult('knowledgeResult', 'üîÑ Test de la base de connaissances...', 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_knowledge?select=*&limit=5`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('knowledgeResult', `‚úÖ Base de connaissances accessible!\n\nNombre d'entr√©es: ${data.length}\n\nExemples:\n${data.map(item => `- ${item.question}`).join('\n')}`, 'success');
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                showResult('knowledgeResult', `‚ùå Erreur d'acc√®s √† la base de connaissances:\n${error.message}`, 'error');
            }
        }

        // Test des conversations
        async function testConversations() {
            showResult('conversationResult', 'üîÑ Test des conversations IA...', 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_conversations?select=count`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    showResult('conversationResult', '‚úÖ Table des conversations accessible!\n\nFonctionnalit√©s disponibles:\n- Enregistrement des conversations\n- Historique des sessions\n- Analytics des interactions', 'success');
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                showResult('conversationResult', `‚ùå Erreur d'acc√®s aux conversations:\n${error.message}`, 'error');
            }
        }

        // Test des statistiques
        async function testAIStats() {
            showResult('statsResult', 'üîÑ Test des statistiques IA...', 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/get_ai_stats`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('statsResult', `‚úÖ Statistiques IA disponibles!\n\nDonn√©es:\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                showResult('statsResult', `‚ùå Erreur d'acc√®s aux statistiques:\n${error.message}`, 'error');
            }
        }

        // Test des politiques RLS
        async function testRLSPolicies() {
            showResult('rlsResult', 'üîÑ Test des politiques RLS...', 'info');
            
            try {
                // Test d'acc√®s sans authentification
                const response = await fetch(`${SUPABASE_URL}/rest/v1/ai_conversations?select=*&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY
                    }
                });
                
                if (response.status === 401 || response.status === 403) {
                    showResult('rlsResult', '‚úÖ Politiques RLS actives!\n\nS√©curit√©:\n- Acc√®s restreint aux conversations\n- Authentification requise\n- Isolation des donn√©es utilisateur', 'success');
                } else {
                    showResult('rlsResult', '‚ö†Ô∏è Politiques RLS peuvent √™tre d√©sactiv√©es\n\nV√©rifiez la configuration de s√©curit√©.', 'error');
                }
            } catch (error) {
                showResult('rlsResult', `‚ùå Erreur de test RLS:\n${error.message}`, 'error');
            }
        }

        // Test complet
        async function runFullTest() {
            showResult('fullTestResult', 'üîÑ Test complet VOP AI en cours...', 'info');
            
            let results = [];
            
            // Test 1: Connexion
            try {
                const dbResponse = await fetch(`${SUPABASE_URL}/rest/v1/ai_knowledge?select=count`);
                results.push('‚úÖ Connexion base de donn√©es');
            } catch (error) {
                results.push('‚ùå Connexion base de donn√©es');
            }
            
            // Test 2: Tables
            try {
                const tables = ['ai_conversations', 'ai_knowledge', 'ai_sessions', 'ai_feedback'];
                let tableResults = [];
                
                for (const table of tables) {
                    try {
                        await fetch(`${SUPABASE_URL}/rest/v1/${table}?select=count`);
                        tableResults.push(`‚úÖ ${table}`);
                    } catch (error) {
                        tableResults.push(`‚ùå ${table}`);
                    }
                }
                
                results.push('üìä Tables:', ...tableResults);
            } catch (error) {
                results.push('‚ùå Test des tables');
            }
            
            // Test 3: Fonctions
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/rpc/get_ai_stats`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                results.push('‚úÖ Fonctions IA');
            } catch (error) {
                results.push('‚ùå Fonctions IA');
            }
            
            showResult('fullTestResult', `üéØ Test Complet VOP AI Termin√©!\n\nR√©sultats:\n${results.join('\n')}\n\nVOP AI est pr√™t pour l'utilisation! ü§ñ‚ú®`, 'success');
        }

        // Message d'information au chargement
        window.onload = function() {
            showResult('fullTestResult', 'üöÄ VOP AI Test Suite Ready!\n\nCliquez sur "Lancer le Test Complet" pour v√©rifier toutes les fonctionnalit√©s.\n\nN\'oubliez pas de configurer vos cl√©s Supabase dans le script!', 'info');
        };
    </script>
</body>
</html>
